let ContaoCookiebar=function(){"use strict";return function(e){let c={},r={},t={selector:".contao-cookiebar",token:"ccb_contao_token",configId:null,pageId:null,hideOnInit:!1,blocking:!1,focusTrap:!0,version:null,lifetime:63072e3,consentLog:!1,cookies:null,configs:null,doNotTrack:!1,currentPageId:0,excludedPageIds:null,disableTracking:!1,texts:{acceptAndDisplay:"Accept"},classes:{onSave:"cc-saved",onShow:"cc-active",onGroupToggle:"cc-active",onGroupSplitSelection:"cc-group-half"}};function i(e){var t=N();t.cookies.includes(e)||(t.cookies.push(parseInt(e)),I(t),r.settings.cookies["_"+e].confirmed=!0,g())}function n(e,t){let o=[];for(var n in r.settings.cookies){var s,c=parseInt(n.replace("_",""));r.settings.cookies.hasOwnProperty(n)&&(s=!!r.settings.cookies[n].confirmed!==(c=e.includes(c))&&!c,r.settings.cookies[n].confirmed=c,!0===t)&&s&&null!==(c=r.settings.cookies[n].token)&&c.forEach(function(e){o.push(e)})}var i;!0===t&&o.length&&((i=new XMLHttpRequest).open("POST","/cookiebar/delete",!0),i.send(L({tokens:o})))}function s(){let e;for(e in r.settings.configs)if(r.settings.configs.hasOwnProperty(e)){let o=r.settings.configs[e];var t=Object.fromEntries(Object.entries(o.cookies).map(([e,t])=>["_"+e,t]));let n=b(t);null!==o.resources&&o.resources.forEach(function(e,t){!(1===e.mode&&n||2===e.mode&&!n||3===e.mode)||v(y(o,t),"config_resource")||k(e)}),null!==o.scripts&&o.scripts.forEach(function(e,t){1===e.mode!==n&&2===e.mode!=!n&&3!==e.mode||v(y(o,t),"config_script")||m(e)})}}function a(){let e;for(e in r.settings.cookies)if(r.settings.cookies.hasOwnProperty(e)){let o=r.settings.cookies[e];null!==o.resources&&o.resources.forEach(function(e,t){!(1===e.mode&&o.confirmed||2===e.mode&&!o.confirmed||3===e.mode)||v(y(o,t),"resource")||k(e)}),null!==o.scripts&&o.scripts.forEach(function(e,t){1===e.mode!==o.confirmed&&2===e.mode!=!o.confirmed&&3!==e.mode||v(y(o,t),"script")||m(e)})}}function l(e){console.info("%cContao Cookiebar:","background: #fff09b; color: #222; padding: 3px","\n"+e)}function d(e){var t=document.querySelectorAll('.cc-module[data-ccb-id="'+e+'"]');t&&t.forEach(function(e){e.parentNode.removeChild(e)}),r.modules["_"+e].forEach(function(e){e()}),delete r.modules["_"+e],f()}function u(e){(e=document.querySelectorAll('iframe[data-ccb-id="'+e+'"]')).length&&e.forEach(function(e){e.src=e.src,e.removeAttribute("data-ccb-id")}),f()}function f(e){var t=N();let o=[];if(r.show||!0===e){if(t.cookies&&t.cookies.length)o=t.cookies;else if(-1===t.version)for(var n in r.settings.cookies){var s=parseInt(n.replace("_",""));r.settings.cookies[n].checked&&o.push(s)}o.length&&o.forEach(function(e,t){e=r.dom.querySelector('[id="c'+e+'"]');e&&(e.checked=!0)});e=r.dom.querySelectorAll('input[name="group[]"]');e&&e.forEach(function(e){if(!e.disabled){e.checked=!1,e.classList.remove(r.settings.classes.onGroupSplitSelection);var o=e.parentElement.querySelectorAll('input[name="cookie[]"]');let t=[];o&&(o.forEach(function(e){e.disabled||t.push(!!e.checked)}),-1===t.indexOf(!1)?e.checked=!0:-1!==t.indexOf(!0)&&-1!==t.indexOf(!1)&&e.classList.add(r.settings.classes.onGroupSplitSelection))}})}}function p(t){r.settings.blocking&&r.dom?.parentElement.querySelectorAll(":scope >:not(script):not(.contao-cookiebar)")?.forEach(e=>{t?e.setAttribute("inert",""):e.removeAttribute("inert")}),r.settings.focusTrap&&(t?(document.addEventListener("keydown",w),r.dom.querySelector(".cc-inner").onanimationend=()=>{r.focused=!1,r.firstFocus?.classList.add("cc-hide-focus"),r.firstFocus?.focus({preventScroll:!0})}):document.removeEventListener("keydown",w))}function o(){r.show?(r.dom.classList.remove(r.settings.classes.onSave),r.dom.classList.add(r.settings.classes.onShow),p(!0)):(r.dom.classList.remove(r.settings.classes.onShow),p(!1))}function g(){var e,t;r.settings.consentLog&&(e=new XMLHttpRequest,t={referrer:window.location.pathname,configId:r.settings.configId,pageId:r.settings.pageId,cookies:N().cookies},e.open("GET","/cookiebar/log?"+L(t),!0),e.send())}const h=function(e){let t=[];e=e.currentTarget;let o=0;e.hasAttribute("data-accept-all")?o=1:e.hasAttribute("data-deny-all")&&(o=2),p(!1),r.inputs.forEach(function(e){2===o?e.checked=!1:1!==o&&!e.checked||(t.push(parseInt(e.value)),e.checked=!0)}),I({configId:r.settings.configId,pageId:r.settings.pageId,version:r.settings.version,saved:x(),cookies:t}),n(t,!0),s(),a(),g(),t.length&&t.forEach(function(e){r.settings.cookies.hasOwnProperty("_"+e)&&"iframe"===r.settings.cookies["_"+e].type&&u(e),r.modules.hasOwnProperty("_"+e)&&d(e)}),r.dom.classList.add(r.settings.classes.onSave);e=new CustomEvent("cookiebar_save",{detail:{cookiebar:r}});window.dispatchEvent(e),f(!0)},m=function(e){if(r.settings.disableTracking)l("Script execution was stopped.");else{e.script=function(e){let t=document.createElement("script");return t.type="text/javascript",t.nonce=document.querySelector("script[nonce]")?.nonce??null,t.innerHTML=e,t}(e.script);var t=e.script;switch(e.position){case 1:document.body.append(t);break;case 2:document.body.prepend(t);break;case 3:document.head.append(t);break}}},k=function(e){if(r.settings.disableTracking)l("Adding a resource was stopped.");else{try{var o=document.querySelectorAll("script[src]"),n=function(e){let t=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]}(e.src);for(let e=o.length;e--;)if(-1!==o[e].src.indexOf(n)&&n!==window.location.host)return!1}catch(e){}let t=document.createElement("script");t.type="text/javascript",t.nonce=document.querySelector("script[nonce]")?.nonce??null,t.src=e.src,t.onload=()=>{r.loadedResources.push(e.src),r.resourcesEvents.length&&r.resourcesEvents.forEach(function(e,t){if(-1===r.loadedResources.indexOf(e.src))return!1;e.callback(),delete r.resourcesEvents[t]})},null!==e.flags&&e.flags.length&&e.flags.forEach(function(e){"object"==typeof e?t.setAttribute(e[0],e[1]):t[e]=!0}),document.head.append(t)}},b=function(e){let t=!1,o;for(o in e)if(r.settings.cookies.hasOwnProperty(o))if(r.settings.cookies[o].confirmed){t=!0;break}return t},v=function(e,t){return r.cache[t]||(r.cache[t]=[]),-1!==r.cache[t].indexOf(e)||(r.cache[t].push(e),!1)},y=function(e,t){return e.id+""+t},E=function(t){t.addEventListener("click",function(e){e.preventDefault(),c.show(t.classList.contains("ccb-prefill"))})},w=function(e){"Tab"!==e.key&&9!==e.keyCode||(r.focused||(r.focused=!0,r.firstFocus?.classList.remove("cc-hide-focus")),document.activeElement!==r.lastFocus||e.shiftKey||(e.preventDefault(),r.firstFocus?.focus()),document.activeElement===r.firstFocus&&e.shiftKey&&(e.preventDefault(),r.lastFocus?.focus()),document.activeElement!==r.toggleOpener)||function(e){for(;e;){if("none"===window.getComputedStyle(e).display)return!1;e=e.parentElement}return!0}(r.lastFocus)||"false"!==r.toggleOpener.ariaExpanded||e.shiftKey||(e.preventDefault(),r.firstFocus?.focus())},S=function(){let o=this.checked;var e=this.parentElement.querySelectorAll('input[name="cookie[]"]');e&&e.forEach(function(e,t){e.disabled||(e.checked=o)}),this.classList.remove(r.settings.classes.onGroupSplitSelection)},O=function(){let o=!this.classList.contains(r.settings.classes.onGroupToggle);this.setAttribute("aria-expanded",o?"true":"false");try{var e=this.parentElement.querySelectorAll(":scope > .toggle-group");e&&e.forEach(function(e,t){e.style.display=o?"block":"none"})}catch(e){this.parentElement.querySelector("[data-toggle-group] ~ .toggle-group").style.display=o?"block":"none"}this.classList.toggle(r.settings.classes.onGroupToggle)};function I(e){localStorage.setItem(T(),JSON.stringify(e))}const L=function(e,t){let o=[],n;for(n in e){var s,c;e.hasOwnProperty(n)&&(s=t?t+"["+n+"]":n,c=e[n],o.push(null!==c&&"object"==typeof c?L(c,s):encodeURIComponent(s)+"="+encodeURIComponent(c)))}return o.join("&")},A=function(){let e={},t=!1,o=0;var n=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],o++);o<n;o++){var s,c=arguments[o],i=(s=void 0,c);for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t&&"[object Object]"===Object.prototype.toString.call(i[s])?e[s]=A(!0,e[s],i[s]):e[s]=i[s])}return e},T=function(){return r.settings.token+"_"+r.settings.configId},N=function(){let e=localStorage.getItem(T());return null===e?(e={configId:r.settings.configId,pageId:r.settings.pageId,version:-1,saved:-1,cookies:[]},localStorage.setItem(T(),JSON.stringify(e))):e=JSON.parse(e),e},x=function(){return Math.floor(+new Date/1e3)};function C(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}c.get=function(){return r},c.getStorage=function(){return N()},c.issetCookie=function(e){let t;var o=N();if(!o.cookies)return!1;if("number"==typeof e)return-1!==o.cookies.indexOf(e);for(t in r.settings.cookies)if(null!==r.settings.cookies[t].token&&-1!==r.settings.cookies[t].token.indexOf(e))return-1!==o.cookies.indexOf(r.settings.cookies[t].id);return-1!==o.cookies.indexOf(e.toString())},c.unblock=function(e,t,o){"iframe"===e.tagName.toLowerCase()?e.src=o:e.tagName.toLowerCase()&&(window.location.href=o),i(t),u(t)},c.addModule=function(t,o,n){var s;if(s=t,o=o,r.modules.hasOwnProperty("_"+s)?r.modules["_"+s].push(o):r.modules["_"+s]=[o],c.issetCookie(t))return d(t),!1;if(n&&"object"==typeof n&&n.selector){let e=null;(e="string"==typeof n.selector?document.querySelector(n.selector):n.selector)&&((s=document.createElement("div")).setAttribute("data-ccb-id",t),s.classList.add("cc-module"),n.message&&(s.innerHTML="<p>"+n.message+"</p>"),"object"==typeof n.button&&!0===n.button.show&&((o=document.createElement("button")).innerHTML=n.button.text||r.settings.texts.acceptAndDisplay,o.type=n.button.type||"button",n.button.classes&&(o.className=n.button.classes),o.addEventListener("click",function(){i(t),d(t)}),s.append(o)),e.appendChild(s))}},c.onResourceLoaded=function(e,t){var o;return r.settings.cookies.hasOwnProperty(e)?r.settings.cookies[e].resources.length?(o=r.settings.cookies[e].resources[0].src,void(-1!==r.loadedResources.indexOf(o)?t():r.resourcesEvents.push({src:o,callback:t}))):(l.warn(`The cookie ID ${e} does not contain any resources.`),!1):(l.warn(`Cookie ID ${e} does not exists.`),!1)},c.show=function(e){r.show=!0,o(),e&&f()},c.hide=function(){r.show=!1,o()},window.document.documentMode&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),o=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;o.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(o)}})}),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("prepend")||Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),o=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;o.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(o,this.firstChild)}})}),"function"!=typeof window.CustomEvent)&&(C.prototype=window.Event.prototype,window.CustomEvent=C),r.settings=A(!0,t,e),r.dom=document.querySelector(r.settings.selector),r.cache={},r.modules={},r.loadedResources=[],r.resourcesEvents=[],r.show=!1;var e=N(),q=(r.settings.hideOnInit||parseInt(e.version)===parseInt(r.settings.version)&&parseInt(e.configId)===parseInt(r.settings.configId)&&!function(e){let t=parseInt(e),o=parseInt(r.settings.lifetime);if(isNaN(t)||t===-1||o===0)return false;return t+o<x()}(e.saved)||r.settings.doNotTrack&&(window.doNotTrack||navigator.doNotTrack||navigator.msDoNotTrack)&&("1"==window.doNotTrack||"yes"==navigator.doNotTrack||"1"==navigator.doNotTrack||"1"==navigator.msDoNotTrack)||r.settings.currentPageId&&r.settings.excludedPageIds&&-1!==r.settings.excludedPageIds.indexOf(r.settings.currentPageId)||(r.show=!0),r.inputs=[],r.dom.querySelectorAll('input[name="cookie[]"]').forEach(function(e,t){e.disabled||r.inputs.push(e)}),r.settings.disableTracking&&l("The execution of scripts is prevented. Please log out of the backend to test scripts, or disable the setting within the cookiebar config."),r.dom.querySelectorAll("[data-toggle-cookies]")),P=r.dom.querySelectorAll("[data-toggle-group]"),_=r.dom.querySelectorAll("[data-save],[data-accept-all],[data-deny-all]"),_=(_.length&&_.forEach(function(e){e.addEventListener("click",h)}),q.length&&q.forEach(function(e){e.addEventListener("click",S)}),P.length&&P.forEach(function(e){e.addEventListener("click",O)}),document.querySelectorAll("a.ccb-trigger, strong.ccb-trigger").forEach(function(e){E(e)}),new MutationObserver(function(e){for(const t of e)"childList"===t.type&&t.addedNodes.forEach(function(e){e.matches&&e.matches("a.ccb-trigger, strong.ccb-trigger")&&E(e)})}).observe(document,{attributes:!1,childList:!0,subtree:!0}),r.settings.focusTrap&&(j=r.dom.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), input[type="checkbox"]:not([disabled])'),r.toggleOpener=r.dom.querySelector("[data-ft-opener]"),r.firstFocus=j[0],r.lastFocus=j[j.length-1]),r.settings.blocking&&new MutationObserver(e=>{for(const t of e)"childList"===t.type&&0<t.addedNodes.length&&t.addedNodes.forEach(e=>{!r.show||e.nodeType!==Node.ELEMENT_NODE||e.classList.contains(".contao-cookiebar")||e.hasAttribute("inert")||e.setAttribute("inert","")})}).observe(r.dom,{childList:!0,subtree:!1}),Object.entries(r.settings.cookies??{}).sort(([,e],[,t])=>t.priority-e.priority)),j=(r.settings.cookies=Array.from(_).reduce((e,[t,o])=>Object.assign(e,{["_"+t]:o}),{}),n(e.cookies),o(),s(),a(),f(),new CustomEvent("cookiebar_init",{detail:{visibility:r.show,cookiebar:r}}));return window.dispatchEvent(j),c}}();