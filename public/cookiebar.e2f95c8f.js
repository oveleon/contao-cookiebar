!function(){"use strict";function e(e){let t=localStorage.getItem(n(e));return null===t?(t={configId:e.settings.configId,pageId:e.settings.pageId,version:-1,saved:-1,cookies:[]},localStorage.setItem(n(e),JSON.stringify(t))):t=JSON.parse(t),t}function t(e,t){localStorage.setItem(n(t),JSON.stringify(e))}function o(t,o){let n,s=e(o);if(!s.cookies)return!1;if("number"==typeof t)return-1!==s.cookies.indexOf(t);for(n in o.settings.cookies)if(null!==o.settings.cookies[n].token&&-1!==o.settings.cookies[n].token.indexOf(t))return-1!==s.cookies.indexOf(o.settings.cookies[n].id);return-1!==s.cookies.indexOf(t.toString())}function n(e){return e.settings.token+"_"+e.settings.configId}function s(t,o){if(!t.show&&!0!==o)return;let n=e(t),s=[];if(n.cookies&&n.cookies.length)s=n.cookies;else if(-1===n.version)for(let e in t.settings.cookies){const o=parseInt(e.replace("_",""));t.settings.cookies[e].checked&&s.push(o)}s.length&&s.forEach(function(e,o){let n=t.dom.querySelector('[id="c'+e+'"]');n&&(n.checked=!0)});let c=t.dom.querySelectorAll('input[name="group[]"]');c&&c.forEach(function(e){if(e.disabled)return;e.checked=!1,e.classList.remove(t.settings.classes.onGroupSplitSelection);let o=e.parentElement.querySelectorAll('input[name="cookie[]"]'),n=[];o&&(o.forEach(function(e){e.disabled||n.push(!!e.checked)}),-1===n.indexOf(!1)?e.checked=!0:-1!==n.indexOf(!0)&&-1!==n.indexOf(!1)&&e.classList.add(t.settings.classes.onGroupSplitSelection))})}const c={selector:".contao-cookiebar",token:"ccb_contao_token",configId:null,pageId:null,hideOnInit:!1,blocking:!1,focusTrap:!0,version:null,lifetime:63072e3,consentLog:!1,cookies:null,configs:null,doNotTrack:!1,currentPageId:0,excludedPageIds:null,disableTracking:!1,texts:{acceptAndDisplay:"Accept"},classes:{onSave:"cc-saved",onShow:"cc-active",onGroupToggle:"cc-active",onGroupSplitSelection:"cc-group-half"}};function i(){let e={},t=0,o=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],o++);let s=function(o){for(let n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t&&"[object Object]"===Object.prototype.toString.call(o[n])?e[n]=i(1,e[n],o[n]):e[n]=o[n])};for(;o<n;o++){s(arguments[o])}return e}function r(e,t){let o,n=[];for(o in e)if(e.hasOwnProperty(o)){let s=t?t+"["+o+"]":o,c=e[o];n.push(null!==c&&"object"==typeof c?r(c,s):encodeURIComponent(s)+"="+encodeURIComponent(c))}return n.join("&")}function a(){return Math.floor(+new Date/1e3)}function l(e){console.info("%cContao Cookiebar:","background: #fff09b; color: #222; padding: 3px","\n"+e)}function u(e,t){if(!e.settings.consentLog)return;let o=new XMLHttpRequest,n={referrer:window.location.pathname,configId:e.settings.configId,pageId:e.settings.pageId,cookies:t.cookies};o.open("GET","/cookiebar/log?"+r(n),!0),o.send()}function d(e,t,n,s){if(function(e,t,o){e.modules.hasOwnProperty("_"+t)?e.modules["_"+t].push(o):e.modules["_"+t]=[o]}(s,e,t),o(e,s))return callModule(e),!1;if(n&&"object"==typeof n&&n.selector){let t=null;if(t="string"==typeof n.selector?document.querySelector(n.selector):n.selector,t){let o=document.createElement("div");if(o.setAttribute("data-ccb-id",e),o.classList.add("cc-module"),n.message&&(o.innerHTML="<p>"+n.message+"</p>"),"object"==typeof n.button&&!0===n.button.show){var c=document.createElement("button");c.innerHTML=n.button.text||s.settings.texts.acceptAndDisplay,c.type=n.button.type||"button",n.button.classes&&(c.className=n.button.classes),c.addEventListener("click",function(){push(e),callModule(e)}),o.append(c)}t.appendChild(o)}}}function f(e,t,o){return o.cache[t]||(o.cache[t]=[]),-1!==o.cache[t].indexOf(e)||(o.cache[t].push(e),!1)}function g(e,t){return e.id+""+t}const p=function(n){let p={},h={};const m=function(o){let n=[],c=o.currentTarget,i=0;c.hasAttribute("data-accept-all")?i=1:c.hasAttribute("data-deny-all")&&(i=2),N(!1),h.inputs.forEach(function(e){2===i?e.checked=!1:(1===i||e.checked)&&(n.push(parseInt(e.value)),e.checked=!0)}),t({configId:h.settings.configId,pageId:h.settings.pageId,version:h.settings.version,saved:a(),cookies:n},h),k(n,!0),b(),y(),u(h,e(h)),n.length&&n.forEach(function(e){h.settings.cookies.hasOwnProperty("_"+e)&&"iframe"===h.settings.cookies["_"+e].type&&x(e),h.modules.hasOwnProperty("_"+e)&&function(e,t){let o=document.querySelectorAll('.cc-module[data-ccb-id="'+t+'"]');o&&o.forEach(function(e){e.parentNode.removeChild(e)}),e.modules["_"+t].forEach(function(e){e()}),delete e.modules["_"+t],s(e)}(h,e)}),h.dom.classList.add(h.settings.classes.onSave),window.dispatchEvent(function(e){return new CustomEvent("cookiebar_save",{detail:{cookiebar:e}})}(h)),s(h,!0)},k=function(e,t){let o=[];for(let n in h.settings.cookies){const s=parseInt(n.replace("_",""));if(!h.settings.cookies.hasOwnProperty(n))continue;let c=!!h.settings.cookies[n].confirmed,i=e.includes(s),r=c!==i&&!i;if(h.settings.cookies[n].confirmed=i,!0===t&&r){let e=h.settings.cookies[n].token;null!==e&&e.forEach(function(e){o.push(e)})}}if(!0===t&&o.length){let e=new XMLHttpRequest;e.open("POST","/cookiebar/delete",!0),e.send(r({tokens:o}))}},b=function(){let e;for(e in h.settings.configs){if(!h.settings.configs.hasOwnProperty(e))continue;let t=h.settings.configs[e];const o=Object.fromEntries(Object.entries(t.cookies).map(([e,t])=>[`_${e}`,t]));let n=w(o);null!==t.resources&&t.resources.forEach(function(e,o){if(1===e.mode&&n||2===e.mode&&!n||3===e.mode){if(f(g(t,o),"config_resource",h))return;E(e)}}),null!==t.scripts&&t.scripts.forEach(function(e,o){if(1===e.mode===n||2===e.mode==!n||3===e.mode){if(f(g(t,o),"config_script",h))return;v(e)}})}},y=function(){let e;for(e in h.settings.cookies){if(!h.settings.cookies.hasOwnProperty(e))continue;let t=h.settings.cookies[e];null!==t.resources&&t.resources.forEach(function(e,o){if(1===e.mode&&t.confirmed||2===e.mode&&!t.confirmed||3===e.mode){if(f(g(t,o),"resource",h))return;E(e)}}),null!==t.scripts&&t.scripts.forEach(function(e,o){if(1===e.mode===t.confirmed||2===e.mode==!t.confirmed||3===e.mode){if(f(g(t,o),"script",h))return;v(e)}})}},v=function(e){h.settings.disableTracking?l("Script execution was stopped."):(e.script=function(e){let t=document.createElement("script");return t.type="text/javascript",t.nonce=document.querySelector("script[nonce]")?.nonce??null,t.innerHTML=e,t}(e.script),function(e,t){switch(t){case 1:document.body.append(e);break;case 2:document.body.prepend(e);break;case 3:document.head.append(e)}}(e.script,e.position))},E=function(e){if(h.settings.disableTracking)return void l("Adding a resource was stopped.");try{let t=document.querySelectorAll("script[src]"),o=function(e){let t=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]}(e.src);for(let e=t.length;e--;)if(-1!==t[e].src.indexOf(o)&&o!==window.location.host)return!1}catch(e){}let t=document.createElement("script");t.type="text/javascript",t.nonce=document.querySelector("script[nonce]")?.nonce??null,t.src=e.src,t.onload=()=>{h.loadedResources.push(e.src),L()},null!==e.flags&&e.flags.length&&e.flags.forEach(function(e){"object"==typeof e?t.setAttribute(e[0],e[1]):t[e]=!0}),document.head.append(t)},w=function(e){let t,o=!1;for(t in e)if(h.settings.cookies.hasOwnProperty(t)&&h.settings.cookies[t].confirmed){o=!0;break}return o},S=function(){document.querySelectorAll("a.ccb-trigger, strong.ccb-trigger").forEach(function(e){I(e)}),new MutationObserver(function(e){for(const t of e)"childList"===t.type&&t.addedNodes.forEach(function(e){e.matches&&e.matches("a.ccb-trigger, strong.ccb-trigger")&&I(e)})}).observe(document,{attributes:!1,childList:!0,subtree:!0})},I=function(e){e.addEventListener("click",function(t){t.preventDefault(),p.show(e.classList.contains("ccb-prefill"))})},O=function(){let e=h.dom.querySelectorAll("[data-toggle-cookies]"),t=h.dom.querySelectorAll("[data-toggle-group]"),o=h.dom.querySelectorAll("[data-save],[data-accept-all],[data-deny-all]");o.length&&o.forEach(function(e){e.addEventListener("click",m)}),e.length&&e.forEach(function(e){e.addEventListener("click",P)}),t.length&&t.forEach(function(e){e.addEventListener("click",j)})},L=function(){if(!h.resourcesEvents.length)return!1;h.resourcesEvents.forEach(function(e,t){if(-1===h.loadedResources.indexOf(e.src))return!1;e.callback(),delete h.resourcesEvents[t]})},x=function(e){let t=document.querySelectorAll('iframe[data-ccb-id="'+e+'"]');t.length&&t.forEach(function(e){e.src=e.src,e.removeAttribute("data-ccb-id")}),s(h)},T=function(e){const t=e.dom.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), input[type="checkbox"]:not([disabled])');e.toggleOpener=e.dom.querySelector("[data-ft-opener]"),e.firstFocus=t[0],e.lastFocus=t[t.length-1]},A=function(e){"Tab"!==e.key&&9!==e.keyCode||(h.focused||(h.focused=!0,h.firstFocus?.classList.remove("cc-hide-focus")),document.activeElement!==h.lastFocus||e.shiftKey||(e.preventDefault(),h.firstFocus?.focus()),document.activeElement===h.firstFocus&&e.shiftKey&&(e.preventDefault(),h.lastFocus?.focus()),document.activeElement!==h.toggleOpener||function(e){for(;e;){if("none"===window.getComputedStyle(e).display)return!1;e=e.parentElement}return!0}(h.lastFocus)||"false"!==h.toggleOpener.ariaExpanded||e.shiftKey||(e.preventDefault(),h.firstFocus?.focus()))},N=function(e){h.settings.blocking&&h.dom?.parentElement.querySelectorAll(":scope >:not(script):not(.contao-cookiebar)")?.forEach(t=>{e?t.setAttribute("inert",""):t.removeAttribute("inert")}),h.settings.focusTrap&&(e?(document.addEventListener("keydown",A),h.dom.querySelector(".cc-inner").onanimationend=()=>{h.focused=!1,h.firstFocus?.classList.add("cc-hide-focus"),h.firstFocus?.focus({preventScroll:!0})}):document.removeEventListener("keydown",A))},q=function(){new MutationObserver(e=>{for(const t of e)"childList"===t.type&&t.addedNodes.length>0&&t.addedNodes.forEach(e=>{!h.show||e.nodeType!==Node.ELEMENT_NODE||e.classList.contains(".contao-cookiebar")||e.hasAttribute("inert")||e.setAttribute("inert","")})}).observe(h.dom,{childList:!0,subtree:!1})},_=function(){h.show?(h.dom.classList.remove(h.settings.classes.onSave),h.dom.classList.add(h.settings.classes.onShow),N(!0)):(h.dom.classList.remove(h.settings.classes.onShow),N(!1))},P=function(){let e=this.checked,t=this.parentElement.querySelectorAll('input[name="cookie[]"]');t&&t.forEach(function(t,o){t.disabled||(t.checked=e)}),this.classList.remove(h.settings.classes.onGroupSplitSelection)},j=function(){let e=!this.classList.contains(h.settings.classes.onGroupToggle);this.setAttribute("aria-expanded",e?"true":"false");let t=this.parentElement.querySelectorAll(":scope > .toggle-group");t&&t.forEach(function(t,o){t.style.display=e?"block":"none"}),this.classList.toggle(h.settings.classes.onGroupToggle)};return p.get=function(){return h},p.getStorage=function(){return e(h)},p.issetCookie=function(e){return console.warn("cookiebar.issetCookie() is deprecated. Use cookiebar.cookieExists() instead."),p.cookieExists(e)},p.cookieExists=function(e){return o(e,h)},p.unblock=function(o,n,s){"iframe"===o.tagName.toLowerCase()?o.src=s:o.tagName.toLowerCase()&&(window.location.href=s),function(o){let n=e(h);n.cookies.includes(o)||(n.cookies.push(parseInt(o)),t(n,h),h.settings.cookies["_"+o].confirmed=!0,u(h,n))}(n),x(n)},p.addModule=function(e,t,o){return d(e,t,o,h)},p.onResourceLoaded=function(e,t){!function(e,t,o){if(!o.settings.cookies.hasOwnProperty(e))return l.warn(`Cookie ID ${e} does not exists.`),!1;if(!o.settings.cookies[e].resources.length)return l.warn(`The cookie ID ${e} does not contain any resources.`),!1;const n=o.settings.cookies[e].resources[0].src;-1!==o.loadedResources.indexOf(n)?t():o.resourcesEvents.push({src:n,callback:t})}(e,t,h)},p.show=function(e){h.show=!0,_(),e&&s(h)},p.hide=function(){h.show=!1,_()},function(){h.settings=i(!0,c,n),h.dom=document.querySelector(h.settings.selector),h.cache={},h.modules={},h.loadedResources=[],h.resourcesEvents=[],h.show=!1;let t=e(h);!h.settings.hideOnInit&&(parseInt(t.version)!==parseInt(h.settings.version)||parseInt(t.configId)!==parseInt(h.settings.configId)||function(e,t){let o=parseInt(e),n=parseInt(t.settings.lifetime);return!isNaN(o)&&-1!==o&&0!==n&&o+n<a()}(t.saved,h))&&function(e){return!e.settings.doNotTrack||!(window.doNotTrack||navigator.doNotTrack||navigator.msDoNotTrack)||!("1"==window.doNotTrack||"yes"==navigator.doNotTrack||"1"==navigator.doNotTrack||"1"==navigator.msDoNotTrack)}(h)&&function(e){return!(e.settings.currentPageId&&e.settings.excludedPageIds&&-1!==e.settings.excludedPageIds.indexOf(e.settings.currentPageId))}(h)&&(h.show=!0),h.inputs=[],h.dom.querySelectorAll('input[name="cookie[]"]').forEach(function(e,t){e.disabled||h.inputs.push(e)}),h.settings.disableTracking&&l("The execution of scripts is prevented. Please log out of the backend to test scripts, or disable the setting within the cookiebar config."),O(),S(),h.settings.focusTrap&&T(),h.settings.blocking&&q(),function(e){const t=Object.entries(e.settings.cookies??{}).sort(([,e],[,t])=>t.priority-e.priority);e.settings.cookies=Array.from(t).reduce((e,[t,o])=>Object.assign(e,{[`_${t}`]:o}),{})}(h),k(t.cookies),_(),b(),y(),s(h),window.dispatchEvent(function(e){return new CustomEvent("cookiebar_init",{detail:{visibility:e.show,cookiebar:e}})}(h))}(),p};window.ContaoCookiebar=p}();